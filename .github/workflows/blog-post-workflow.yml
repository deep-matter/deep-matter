name: Profile Stats & Snake Animation
on:
  schedule:
    # Run every 6 hours
    - cron: '0 */6 * * *'
  # This command allows us to run the Action automatically from the Actions tab.
  workflow_dispatch:
  push: 
    branches: ["main", "master"]

jobs:
  update-profile-stats:
    name: Update Profile with Latest Stats
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      # Generate dynamic tech stats based on recent repositories
      - name: Update Tech Stack Stats
        run: |
          echo "ðŸš€ Updating profile stats..."
          # This could be expanded to analyze recent commits, languages used, etc.
          echo "Last updated: $(date)" > LAST_UPDATED
          
      # Generate Snake Animation
      - name: Generate Snake Animation
        uses: Platane/snk@v3
        id: snake-gif
        with:
          github_user_name: deep-matter
          outputs: |
            dist/github-contribution-grid-snake.svg
            dist/github-contribution-grid-snake-dark.svg?palette=github-dark
            
      # Generate Profile Summary Cards
      - name: Generate Profile Summary
        run: |
          curl -X GET "https://github-profile-summary-cards.vercel.app/api/cards/profile-details?username=Deep-matter&theme=github_dark" -o dist/profile-summary.svg
          
      # Deploy to GitHub Pages
      - name: Deploy to GitHub Pages
        uses: crazy-max/ghaction-github-pages@v3
        with:
          target_branch: output
          build_dir: dist
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
  # Optional: Update AI Project Showcase
  update-ai-showcase:
    name: Update AI Project Showcase
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      - name: Update AI Projects List
        run: |
          echo "# ðŸ¤– AI Projects Showcase" > AI_PROJECTS.md
          echo "" >> AI_PROJECTS.md
          echo "## Recent AI & ML Projects" >> AI_PROJECTS.md
          echo "" >> AI_PROJECTS.md
          echo "ðŸ”¬ **LLM Fine-tuning**: DevStral model optimization for code analysis" >> AI_PROJECTS.md
          echo "ðŸ§  **GraphRAG Systems**: Multi-agent retrieval with semantic search" >> AI_PROJECTS.md
          echo "âš¡ **Distributed AI**: FAISS vector databases with HNSW indexing" >> AI_PROJECTS.md
          echo "ðŸ¥ **Medical AI**: Computer vision for brain tumor segmentation" >> AI_PROJECTS.md
          echo "ðŸ” **Bug Localization**: Automated software debugging with AI" >> AI_PROJECTS.md
          echo "" >> AI_PROJECTS.md
          echo "_Last updated: $(date)_" >> AI_PROJECTS.md
          
      - name: Commit AI Projects Update
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add AI_PROJECTS.md
          git diff --staged --quiet || git commit -m "ðŸ¤– Update AI projects showcase"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # Generate Dynamic Profile README Stats
  generate-metrics:
    name: Generate Profile Metrics
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      # This step could be expanded to generate custom metrics
      - name: Generate Custom AI Metrics
        run: |
          echo "Generating AI/ML specific metrics..."
          # Could include things like:
          # - Number of AI/ML repositories
          # - Languages used in ML projects
          # - Publication count, etc.
          
      - name: Update Profile Stats
        run: |
          echo "Profile metrics updated on: $(date)" > METRICS_UPDATE.txt
          
      - name: Commit metrics
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add METRICS_UPDATE.txt
          git diff --staged --quiet || git commit -m "ðŸ“Š Update profile metrics"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}